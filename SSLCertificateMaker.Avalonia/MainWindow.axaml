<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:dialogHost="clr-namespace:DialogHostAvalonia;assembly=DialogHost.Avalonia"
		xmlns:cm="using:SSLCertificateMaker"
		xmlns:vm="using:SSLCertificateMaker.Avalonia"
        mc:Ignorable="d"
        x:Class="SSLCertificateMaker.Avalonia.MainWindow"
        Title="SSL Certificate Maker"
        Width="600" Height="600"
        MinWidth="520" MinHeight="580">
	
	<dialogHost:DialogHost Identifier="RootDialog" CloseOnClickAway="True">
		<Grid RowDefinitions="*,Auto" RowSpacing="5" ColumnSpacing="5">
			<TabControl Grid.Row="0" x:Name="tabControl">
				<TabItem Header="New Certificate">
					<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
						<Grid ColumnDefinitions="Auto,*" Margin="8" RowSpacing="3" ColumnSpacing="3">
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto" />
								<RowDefinition Height="*" MinHeight="80"/>
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
								<RowDefinition Height="Auto" />
							</Grid.RowDefinitions>
							<!-- Header -->
							<TextBlock Grid.Row="0" Grid.Column="0" Text="Certificate Authority:" VerticalAlignment="Center" />
							<ComboBox Grid.Row="0" Grid.Column="1" x:Name="IssuerCombo" HorizontalAlignment="Stretch" />

							<!-- Main content -->
							<!-- Domains -->
							<Grid RowDefinitions="Auto,*" Grid.Row="1" Grid.Column="0">
								<TextBlock Grid.Row="0" Text="Domain Names:" />
								<TextBlock Grid.Row="1" TextWrapping="Wrap" FontSize="12" Width="120" VerticalAlignment="Center"
									Text="One per line. First line is Subject Name; others are Subject Alternative Names." />
							</Grid>
							<ScrollViewer Grid.Row="1" Grid.Column="1" VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
								<TextBox x:Name="DomainsTextBox" AcceptsReturn="True"
								TextWrapping="Wrap" MinHeight="50" Text="localhost" />
							</ScrollViewer>

							<!-- Presets -->
							<TextBlock Grid.Row="2" Grid.Column="0" Text="Presets:" VerticalAlignment="Center" />
							<StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="8">
								<Button x:Name="WebServerPresetButton" Content="Web Server" />
								<Button x:Name="CaPresetButton" Content="Certificate Authority" />
							</StackPanel>

							<!-- Key Usage -->
							<TextBlock Grid.Row="3" Grid.Column="0" Text="Key Usage:" VerticalAlignment="Center" />
							<StackPanel Grid.Row="3" Grid.Column="1">
								<StackPanel Orientation="Horizontal" Spacing="8">
									<Button x:Name="KeyUsageEditButton">
										<Image x:Name="PenImage1" Height="18" Width="18" Source="avares://SSLCertificateMaker.Avalonia/pen.png" />
									</Button>
									<TextBlock x:Name="txtKeyUsage" TextWrapping="Wrap" VerticalAlignment="Center" />
								</StackPanel>
								<Border x:Name="KeyUsageBox" BorderThickness="1" CornerRadius="4" BorderBrush="Gray" Margin="4" IsVisible="false">	
									<ListBox x:Name="KeyUsageListBox" SelectionMode="Multiple">
										<ListBox.ItemTemplate>
											<DataTemplate x:DataType="cm:MultiSelectKeyPurposeItem">
												<CheckBox Content="{Binding Key}"
														  IsChecked="{Binding IsSelected, Mode=TwoWay, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" />
											</DataTemplate>
										</ListBox.ItemTemplate>
									</ListBox>
								</Border>
							</StackPanel>

							<!-- Extended Key Usage -->
							<TextBlock Grid.Row="4" Grid.Column="0" Text="Extended Key Usage:" VerticalAlignment="Center" />
							<StackPanel Grid.Row="4" Grid.Column="1">
								<StackPanel Orientation="Horizontal" Spacing="8">
									<Button x:Name="ExtendedKeyUsageEditButton">
										<Image x:Name="PenImage2" Height="18" Width="18" Source="avares://SSLCertificateMaker.Avalonia/pen.png" />
									</Button>
									<TextBlock x:Name="txtExtendedKeyUsage" TextWrapping="Wrap" VerticalAlignment="Center" />
								</StackPanel>
								<Border x:Name="ExtendedKeyUsageBox" BorderThickness="1" BorderBrush="Gray" CornerRadius="4" IsVisible="false">
									<ListBox x:Name="ExtendedKeyUsageListBox" SelectionMode="Multiple">
										<ListBox.ItemTemplate>
											<DataTemplate x:DataType="cm:MultiSelectIntItem">
												<CheckBox Content="{Binding Key}"
													IsChecked="{Binding IsSelected, Mode=TwoWay, RelativeSource={RelativeSource AncestorType=ListBoxItem}}" />
											</DataTemplate>
										</ListBox.ItemTemplate>
									</ListBox>
								</Border>
							</StackPanel>

							<!-- Dates -->
							<TextBlock Grid.Row="5" Grid.Column="0" Text="Valid From:" VerticalAlignment="Center" />
							<DatePicker Grid.Row="5" Grid.Column="1" x:Name="ValidFromDatePicker" />

							<TextBlock Grid.Row="6" Grid.Column="0" Text="Valid Until:" VerticalAlignment="Center" />
							<DatePicker Grid.Row="6" Grid.Column="1" x:Name="ValidToDatePicker" />

							<!-- Key strength -->
							<TextBlock Grid.Row="7" Grid.Column="0" Text="Key Strength:" VerticalAlignment="Center"
								ToolTip.Tip="If generating a certificate to be used as a certificate authority, choose a higher value such as 4096." />
							<StackPanel Grid.Row="7" Grid.Column="1" Orientation="Horizontal" Spacing="6">
								<ComboBox x:Name="KeyStrengthComboBox" Width="90" ToolTip.Tip="If generating a certificate to be used as a certificate authority, choose a higher value such as 4096." />
								<TextBlock Text="Bits (2048 builds fast, 4096 is more secure)" TextWrapping="Wrap" VerticalAlignment="Center"
									ToolTip.Tip="If generating a certificate to be used as a certificate authority, choose a higher value such as 4096." />
							</StackPanel>

							<!-- Output -->
							<TextBlock Grid.Row="8" Grid.Column="0" Text="Output Type:" VerticalAlignment="Center" />
							<ComboBox Grid.Row="8" Grid.Column="1" x:Name="OutputTypeComboBox" Width="120" />

							<!--Password -->
							<TextBlock Grid.Row="9" Grid.Column="0" Text="Pfx Password:" VerticalAlignment="Center" />
							<Grid Grid.Row="9" Grid.Column="1" ColumnDefinitions="*,Auto">
								<vm:PasswordBox Grid.Column="0" x:Name="PasswordTextBox" HorizontalAlignment="Stretch" />
							</Grid>

							<!-- Action row -->
							<Border Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="2" Padding="4" HorizontalAlignment="Stretch" Margin="10">
								<StackPanel Spacing="10">
									<!--<TextBlock Text="The certifiate will be saved in your Documents/SSL-Certificates folder" />-->
									<Button x:Name="MakeCertButton" Content="Make Certificate" HorizontalAlignment="Right" />
								</StackPanel>
							</Border>
						</Grid>
					</ScrollViewer>
				</TabItem>
				<TabItem Header="Convert">
					<Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*" RowSpacing="5" ColumnSpacing="10">
						<Border Grid.ColumnSpan="2" Margin="0,15">
							<TextBlock TextWrapping="Wrap">
								<Run Text="This tool allows you to convert certificates between formats. The supported formats are:" /><LineBreak/>
								<LineBreak/>
								<Run Text="1) .pfx" /><LineBreak/>
								<Run Text="2) .cer and .key (both files must exist, names differing only in their extensions)" /><LineBreak/>
								<LineBreak/>
								<Run Text="The files must exist in the Documents/SSL-Certificates in order to be found by this program." />
							</TextBlock>
						</Border>
						<TextBlock Grid.Row="1" Grid.Column="0" Text="Certificate:" />
						<ComboBox Grid.Row="1" Grid.Column="1" x:Name="CertificateCombo" HorizontalAlignment="Stretch" />
						<!-- Action row -->
						<Border Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Padding="4" HorizontalAlignment="Stretch" Margin="10">
							<StackPanel Spacing="10">
								<TextBlock Text="The converted certifiate will be saved in your Documents/SSL-Certificates folder" />
								<Button x:Name="ConvertButton" Content="Convert" HorizontalAlignment="Right" />
							</StackPanel>
						</Border>
					</Grid>
				</TabItem>
			</TabControl>

			<!-- Status bar -->
			<DockPanel Grid.Row="1" LastChildFill="True">
				<ProgressBar x:Name="ProgressBar" Width="120" Height="16" IsIndeterminate="False" />
				<TextBlock x:Name="StatusTextBlock" VerticalAlignment="Center" Text="Ready" TextWrapping="Wrap" Margin="10,0" />
			</DockPanel>
		</Grid>
	</dialogHost:DialogHost>
</Window>
